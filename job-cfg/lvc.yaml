- defaults:
    name: lvc
    project-type: freestyle
    description: '{my_description}<br><br>Job configuration source is <a href="https://anonscm.debian.org/git/qa/jenkins.debian.net.git/tree/job-cfg/lvc.yaml">lvc.yaml</a>.'
    properties:
      - sidebar:
          url: https://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar:
          url: https://jenkins.debian.net/view/lvc
          text: Jobs for libvirt and cucumber based tests
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar:
          url: http://www.profitbricks.co.uk
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png
      - throttle:
          max-total: 1
          max-per-node: 1
          enabled: true
          option: category
          categories:
            - lvc
    parameters:
      - string:
          name: PU_GIT_BRANCH
          description: The git branch that triggered the build that reulted in this subsequent build
    logrotate:
      daysToKeep: 90
      numToKeep: 20
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    publishers:
      - email:
          recipients: 'qa-jenkins-scm@lists.alioth.debian.org, phil@hands.com'
      - archive:
          artifacts: '{my_pngs}, results/*.mpg, results/*.log'
          latest-only: false
      - image-gallery:
          - title: '{my_title}'
            includes: '{my_pngs}'
            image-width: 300
    wrappers:
      - live-screenshot
    builders:
      - shell: '/srv/jenkins/bin/jenkins_master_wrapper.sh {my_iso} /srv/jenkins/cucumber/features {my_opts}'
    triggers:
      - timed: '{my_time}'
    node: 'lvc'

- job-template:
    defaults: lvc
    name: '{name}_{distro}'

- project:
    name: lvc
    my_title: 'Cucumber: {dist_name}'
    my_time: '45 23 31 12 *'
    my_pngs: 'results/*.png'
    my_opts: '--tags ~@broken'
    my_description: 'Work in progress...'
    jobs:
        - '{name}_{distro}':
            distro:
                #- 'debian-stable':
                #    dist_name: 'Debian-Installer stable'
                #    my_iso: 'http://cdimage.debian.org/debian-cd/8.5.0/amd64/iso-cd/debian-8.5.0-amd64-netinst.iso'
                - 'debian-stable':
                    dist_name: 'Debian-Installer Stable'
                    my_iso: 'http://cdimage.debian.org/debian-cd/8.5.0/amd64/iso-cd/debian-8.5.0-amd64-netinst.iso'
                - 'debian-testing-daily': 
                    dist_name: 'Debian-Installer Testing (Daily)'
                    my_iso: 'http://cdimage.debian.org/cdimage/daily-builds/daily/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso'
                    my_time: 'H */8 * * *'
                - 'debian-miniiso':
                    dist_name: 'Debian-Installer local mini.iso'
                    my_iso: '$PU_GIT_BRANCH'
                - 'debian-testing-daily-broken': 
                    dist_name: 'Debian-Installer Testing (Daily) -- Broken Scenarios'
                    my_iso: 'http://cdimage.debian.org/cdimage/daily-builds/daily/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso'
                    my_time: 'H H * * H'
                    my_opts: '--tags @broken'
