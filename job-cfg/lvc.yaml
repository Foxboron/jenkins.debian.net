- defaults:
    name: lvc
    project-type: freestyle
    description: &desc '{my_description}<br><br>Job configuration source is <a href="https://anonscm.debian.org/git/qa/jenkins.debian.net.git/tree/job-cfg/lvc.yaml">lvc.yaml</a>.'
    properties:
      - sidebar: &sb1
          url: https://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar: &sb2
          url: https://jenkins.debian.net/view/lvc
          text: Jobs for libvirt and cucumber based tests
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar: &sb3
          url: http://www.profitbricks.co.uk
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png
      - throttle:
          max-total: 1
          max-per-node: 1
          enabled: true
          option: category
          categories:
            - lvc
    parameters:
      - string:
          name: TRIGGERING_BRANCH
          description: The git branch that triggered the build that reulted in this subsequent build
    logrotate:
      daysToKeep: 90
      numToKeep: 60
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    publishers:
      - email:
          recipients: 'qa-jenkins-scm@lists.alioth.debian.org, phil@hands.com'
      - archive:
          artifacts: '{my_pngs}, results/*.mpg, results/*.log'
          latest-only: false
      - image-gallery:
          - title: '{my_title}'
            includes: '{my_pngs}'
            image-width: 300
    builders:
      - shell: '/srv/jenkins/bin/jenkins_master_wrapper.sh {my_iso} /srv/jenkins/cucumber/features {my_opts}'
    triggers:
      - timed: '{my_time}'
    node: 'lvc'

- job-template:
    defaults: lvc
    name: '{name}_{distro}'

- project:
    name: lvc
    my_title: 'Cucumber: {dist_name}'
    my_time: '45 23 01 11 *'
    my_pngs: 'results/*.png'
    my_opts: '--tags both-ui'
    my_opts: '--tags ~@broken --tags ~@trivial --tags ~@preseed --tags ~@text-ui --tags ~@gui --tags ~@debedu'
    my_description: 'Work in progress...'
    jobs:
        - '{name}_{distro}':
            distro:
                - 'debian-stable':
                    dist_name: 'Debian-Installer Stable'
                    my_iso: 'http://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-8.7.1-amd64-netinst.iso'
                    my_time: 'H H * * H'
                - 'debian-testing-daily':
                    dist_name: 'Debian-Installer Testing (Daily)'
                    my_iso: 'http://cdimage.debian.org/cdimage/daily-builds/daily/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso'
                    my_time: 'H H/8 * * *'
                - 'debian-DI-miniiso-gui-daily':
                    dist_name: 'Debian-Installer Testing GTK-miniiso (Daily)'
                    my_iso: 'https://d-i.debian.org/daily-images/amd64/daily/netboot/gtk/mini.iso'
                    my_time: 'H H/8 * * *'
                    my_opts: '--tags @gui'
                - 'debian-DI-miniiso-text-daily':
                    dist_name: 'Debian-Installer Testing Text-miniiso (Daily)'
                    my_iso: 'https://d-i.debian.org/daily-images/amd64/daily/netboot/mini.iso'
                    my_time: 'H H/8 * * *'
                    my_opts: '--tags @text-ui'
                - 'debian-miniiso':
                    dist_name: 'Debian-Installer local mini.iso'
                    my_iso: 'use_TRIGGERING_BRANCH'
                    my_opts: '--tags @bugtest'
                - 'debian-DI-miniiso-gui-daily-bugtest':
                    dist_name: 'Debian-Installer Testing GTK-miniiso (Daily) bugtest'
                    my_iso: 'https://d-i.debian.org/daily-images/amd64/daily/netboot/gtk/mini.iso'
                    my_time: 'H H/8 * * *'
                    my_opts: '--tags @bugtest'
                - 'debian-stretch-DI':
                    dist_name: 'Debian-Installer Stretch pre-release'
                    my_iso: 'http://cdimage.debian.org/cdimage/stretch_di_rc2/amd64/iso-cd/debian-stretch-DI-rc2-amd64-netinst.iso'
                    my_time: 'H H * * H'
                - 'debianedu-testing-netinst':
                    dist_name: 'Debian-Edu Testing Netinst'
                    my_iso: 'http://ftp.skolelinux.org/cd-stretch-amd64-i386-netinst/debian-edu-amd64-i386-NETINST-1.iso'
                    my_time: 'H H * * H'
                    my_opts: '--tags @debedu'
                #- 'debian-testing-daily-broken':
                #    dist_name: 'Debian-Installer Stretch alpha8 -- Broken Scenarios'
                #    my_iso: 'http://cdimage.debian.org/cdimage/stretch_di_alpha8/amd64/iso-cd/debian-stretch-DI-alpha8-amd64-netinst.iso'
                #    my_time: 'H H * * H'
                #    my_opts: '--tags @broken'
