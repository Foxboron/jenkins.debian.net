- defaults:
    name: torbrowser-launcher
    project-type: freestyle
    triggers:
      - timed: '{my_timed}'
    properties:
      - sidebar:
          url: https://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar:
          url: https://jenkins.debian.net/view/torbrowser-launcher
          text: torbrowser-launcher builds jobs
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar:
          url: http://www.profitbricks.co.uk
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png
    description: '{my_description}<br>Job configuration source is <a href="http://anonscm.debian.org/cgit/qa/jenkins.debian.net.git/tree/job-cfg/torbrowser-launcher.yaml">torbrowser-launcher.yaml</a>.<br>Results are available at <a href="https://torbrowser-launcher.debian.net/">https://torbrowser-launcher.debian.net</a>.'
    logrotate:
      daysToKeep: 90
      numToKeep: 30
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    builders:
      - shell: '{my_shell}'
    publishers:
      - logparser:
          parse-rules: '/srv/jenkins/logparse/torbrowser-launcher.rules'
          unstable-on-warning: 'true'
          fail-on-error: 'true'
      - email:
          recipients: '{my_recipients}'
    wrappers:
      - live-screenshot
    node: '{my_node}'

- defaults:
    name: torbrowser-launcher_git
    project-type: freestyle
    triggers:
      - timed: '{my_timed}'
      - pollscm: '*/6 * * * *'
    properties:
      - sidebar:
          url: https://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar:
          url: https://jenkins.debian.net/view/torbrowser-launcher
          text: torbrowser-launcher jobs
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar:
          url: http://www.profitbricks.co.uk
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png
    description: '{my_description}<br>Job configuration source is <a href="http://anonscm.debian.org/cgit/qa/jenkins.debian.net.git/tree/job-cfg/torbrowser-launcher.yaml">torbrowser-launcher.yaml</a>.<br>Results are available at <a href="https://torbrowser-launcher.debian.net/">https://torbrowser-launcher.debian.net</a>.'
    logrotate:
      daysToKeep: 90
      numToKeep: 20
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    builders:
      - shell: '{my_shell}'
    publishers:
      - logparser:
          parse-rules: '/srv/jenkins/logparse/torbrowser-launcher.rules'
          unstable-on-warning: 'true'
          fail-on-error: 'true'
      - email:
          recipients: '{my_recipients}'
    scm:
      - git:
          url: '{my_gitrepo}'
          branches:
            - master
    node: '{my_node}'

- job-template:
    defaults: torbrowser-launcher
    name: '{name}_setup_schroot_unstable_amd64'

- job-template:
    defaults: torbrowser-launcher
    name: '{name}_setup_schroot_stretch_amd64'

- job-template:
    defaults: torbrowser-launcher
    name: '{name}_setup_schroot_jessie_amd64'

- job-template:
    defaults: torbrowser-launcher_git
    name: '{name}_test_unstable_amd64'

- job-template:
    defaults: torbrowser-launcher_git
    name: '{name}_test_stretch_amd64'

- job-template:
    defaults: torbrowser-launcher_git
    name: '{name}_test_jessie_amd64'

- project:
    name: torbrowser-launcher
    jobs:
        - '{name}_setup_schroot_unstable_amd64':
            my_description: 'Setup unstable/amd64 schroot for testing torbrowser-launcher.'
            my_timed: '42 1 * * *'
            my_shell: '/srv/jenkins/bin/schroot-create.sh torbrowser-launcher torbrowser-launcher-unstable unstable torbrowser-launcher'
            my_recipients: 'holger@layer-acht.org'
            my_node: ''
        - '{name}_setup_schroot_stretch_amd64':
            my_description: 'Setup stretch/amd64 schroot for testing torbrowser-launcher.'
            my_timed: '42 1 * * *'
            my_shell: '/srv/jenkins/bin/schroot-create.sh torbrowser-launcher torbrowser-launcher-stretch stretch torbrowser-launcher'
            my_recipients: 'holger@layer-acht.org'
            my_node: ''
        - '{name}_setup_schroot_jessie_amd64':
            my_description: 'Setup jessie/amd64 schroot for testing torbrowser-launcher.'
            my_timed: '42 1 * * *'
            my_shell: '/srv/jenkins/bin/schroot-create.sh torbrowser-launcher torbrowser-launcher-jessie jessie torbrowser-launcher'
            my_recipients: 'holger@layer-acht.org'
            my_node: ''
        - '{name}_test_unstable_amd64':
            my_description: 'Test torbrowser-launcher on unstable/amd64 daily and on every commit to GIT.'
            my_timed: '20 24 * * *'
            my_gitrepo: 'git://git.debian.org/git/collab-maint/torbrowser-launcher.git'
            my_shell: '/srv/jenkins/bin/test_torbrowser-launcher.sh unstable'
            my_recipients: 'holger@layer-acht.org'
            my_node: ''
        - '{name}_test_stretch_amd64':
            my_description: 'Test torbrowser-launcher on stretch/amd64 daily and on every commit to GIT.'
            my_timed: '20 24 * * *'
            my_gitrepo: 'git://git.debian.org/git/collab-maint/torbrowser-launcher.git'
            my_shell: '/srv/jenkins/bin/test_torbrowser-launcher.sh stretch'
            my_recipients: 'holger@layer-acht.org'
            my_node: ''
        - '{name}_test_jessie_amd64':
            my_description: 'Test torbrowser-launcher on jessie/amd64 daily and on every commit to GIT.'
            my_timed: '20 24 * * *'
            my_gitrepo: 'git://git.debian.org/git/collab-maint/torbrowser-launcher.git'
            my_shell: '/srv/jenkins/bin/test_torbrowser-launcher.sh jessie'
            my_recipients: 'holger@layer-acht.org'
            my_node: ''

