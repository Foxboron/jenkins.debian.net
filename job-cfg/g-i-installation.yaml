
- defaults:
    name: g-i-installation
    description: '{my_description}{do_not_edit}'
    # disabled: true
    logrotate:
      daysToKeep: 90
      numToKeep: 20
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    triggers:
      - timed: "{my_time}"
    builders:
      - shell: "{my_shell}"
    publishers:
      - trigger:
          project: '{my_trigger}'
      - logparser:
          parse-rules: '/srv/jenkins/logparse/debian.rules'
          unstable-on-warning: 'true'
          fail-on-error: 'true'
      - email-ext:
          recipients: '{my_recipients}'
          first-failure: true
          fixed: true
          subject: '$BUILD_STATUS: $JOB_NAME/$BUILD_NUMBER'
          attach-build-log: false
          body: 'See $BUILD_URL and $BUILD_URL/console and $BUILD_URL/artifact/results/ if there are any.'
      - archive:
          artifacts: 'results/*.*, results/log/*, results/log/installer/*'
          latest-only: false
      - image-gallery:
          - title: '{my_title}'
            includes: 'results/*.png'
            image-width: 300
    wrappers:
      - live-screenshot
      - timeout:
          timeout: 360
    properties:
      - sidebar: &sb01
          url: https://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar: &sb10
          url: https://jenkins.debian.net/view/g-i-installation/
          text: All g-i-installation jobs
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar: &sb99
          url: http://www.profitbricks.co.uk
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png
      - priority-sorter:
          priority: '140'
      - throttle:
          max-total: 3
          max-per-node: 3
          enabled: true
          option: category
          categories:
            - g-i-installation
- defaults:
    name: g-i-installation-maintenance
    description: 'Cleanup and monitor so that there is a predictable environment.{do_not_edit}'
    logrotate:
      daysToKeep: 90
      numToKeep: 20
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    triggers:
      - timed: "0 6 * * *"
    builders:
      - shell: '/srv/jenkins/bin/maintenance.sh {name}'
    publishers:
      - logparser:
          parse-rules: '/srv/jenkins/logparse/debian.rules'
          unstable-on-warning: 'true'
          fail-on-error: 'true'
      - email:
          recipients: 'qa-jenkins-scm@lists.alioth.debian.org'
    properties:
      - sidebar: *sb01
      - sidebar: *sb10
      - sidebar: *sb99
      - priority-sorter:
          priority: '175'

- job-template:
    defaults: g-i-installation-maintenance
    name: '{name}_maintenance'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian_{my_desktop}'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian_{my_dist}_{my_desktop}'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian-edu_jessie-{my_image}_{my_de_profile}'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian-edu_{my_dist}_{my_de_profile}'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian-edu_{my_dist}_{my_de_profile}_{my_desktop}'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian_sid_daily_rescue_{my_langname}'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian_{my_dist}_presentation'

# =-=-=-=

- job-template:
    defaults: g-i-installation
    name: '{name}_debian_sid_daily_hurd_lxde'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian_sid_daily_rescue'

- job-template:
    defaults: g-i-installation
    name: '{name}_debian_sid_daily_rescue_dark_theme'

# =-=-=-=

- job-group:
    name: '{name}_debian-edu_group'
    my_disksize: 25
    my_dist:
      - wheezy
    my_de_profile:
      - minimal:
          my_time: '23 20 15 * *'
      - standalone:
          my_time: '42 20 15 * *'
      - workstation:
          my_time: '42 22 16 * *'
      - combi-server:
          my_time: '42 0 16 * *'
          my_disksize: 30
      - main-server:
          my_time: '42 2 16 * *'
          my_disksize: 30
    jobs:
      - '{name}_debian-edu_{my_dist}_{my_de_profile}':
          my_title: 'Debian Edu ({my_dist}) {my_de_profile}'
          my_shell: '/srv/jenkins/bin/g-i-installation.sh {my_disksize} http://ftp.skolelinux.org/cd-{my_dist}-amd64-i386-netinst/debian-edu-amd64-i386-NETINST-1.iso'
          my_description: 'Do a fully automated installation of a Debian Edu {my_dist} {my_de_profile} profile - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian-edu_{my_dist}_{my_de_profile}_preseed.cfg">this preseed.cfg</a>) using the netinst CD image.'
          my_trigger: ''
          my_recipients: 'jenkins+debian-edu debian-edu-commits@lists.alioth.debian.org'

- job-group:
    name: '{name}_debian-edu_desktops_group'
    my_disksize: 25
    my_dist: wheezy
    my_de_profile: standalone
    my_desktop:
      - gnome:
          my_time: '42 18 17 * *'
      - lxde:
          my_time: '42 22 17 * *'
      - xfce:
          my_time: '42 2 * * 1'
    jobs:
      - '{name}_debian-edu_{my_dist}_{my_de_profile}_{my_desktop}':
          my_title: 'Debian Edu ({my_dist}) {my_de_profile} ({my_desktop})'
          my_shell: '/srv/jenkins/bin/g-i-installation.sh {my_disksize} http://ftp.skolelinux.org/cd-{my_dist}-amd64-i386-netinst/debian-edu-amd64-i386-NETINST-1.iso'
          my_description: 'Do a fully automated installation of a Debian Edu {my_dist} {my_de_profile} profile - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian-edu_{my_dist}_{my_de_profile}_preseed.cfg">this preseed.cfg</a>) using the netinst CD image.'
          my_trigger: ''
          my_recipients: 'jenkins+debian-edu debian-edu-commits@lists.alioth.debian.org'

- job-group:
    name: '{name}_debian_wheezy_desktops_group'
    my_optdesc: ''
    my_instdesc: ' using netboot gtk'
    my_dist:
      - wheezy:
          my_inst_url: 'http://ftp.de.debian.org/debian/dists/wheezy/main/installer-amd64/current/images/netboot/gtk/debian-installer/amd64/'
    my_desktop:
      - kde:
          my_time: '42 15 2,9,16,23 * *'
          my_preseed: 'kde'
      - xfce:
          my_time: '42 16 4 * *'
          my_preseed: 'xfce'
      - lxde:
          my_time: '42 19 4 * *'
          my_preseed: 'lxde'
      - gnome:
          my_time: '42 19 4 * *'
          my_preseed: 'gnome'
      - kfreebsd_xfce:
          my_time: '42 16 21 * *'
          my_inst_url: 'http://ftp.de.debian.org/debian/dists/wheezy/main/installer-kfreebsd-amd64/current/images/netboot-9/gtk/netboot.tar.gz'
          my_preseed: 'kfreebsd'
          my_instdesc: 'using PXE netboot gtk'
    jobs:
      - '{name}_debian_{my_dist}_{my_desktop}':
          my_title: 'Debian ({my_dist}) {my_desktop} desktop install{my_optdesc}'
          my_description: 'Do a fully automated installation of Debian {my_desktop} desktop{my_optdesc} - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_{my_dist}_{my_preseed}_preseed.cfg">this preseed.cfg</a>){my_instdesc}.'
          my_trigger: ''
          my_shell: '/srv/jenkins/bin/g-i-installation.sh 10 {my_inst_url}'
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org'

- job-group:
    name: '{name}_debian_sid_daily_desktops_group'
    my_optdesc: ''
    my_trigger: ''
    my_time: ''
    my_instdesc: ' using netboot gtk'
    my_inst_url: http://cdimage.debian.org/cdimage/daily-builds/sid_d-i/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso
    my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org'
    my_dist:
      - sid_daily
    my_desktop:
      - gnome:
          my_time: '42 8 * * *'
          my_preseed: gnome
          my_trigger: 'g-i-installation_debian_sid_gnome_brltty, g-i-installation_debian_sid_gnome_speakup'
      - gnome_brltty:
          my_preseed: 'gnome_brltty'
          my_optdesc: ' with braille display support'
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org debian-accessibility@lists.debian.org'
      - gnome_speakup:
          my_preseed: 'gnome_speakup'
          my_optdesc: ' with Speakup support'
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org debian-accessibility@lists.debian.org'
      - xfce:
          my_preseed: 'xfce'
          my_time: '42 8 * * *'
      - kfreebsd_xfce:
          my_inst_url: 'http://d-i.debian.org/daily-images/kfreebsd-amd64/daily/netboot-10/gtk/netboot.tar.gz'
          my_preseed: 'kfreebsd'
          my_time: '42 8 */7 * *'
          my_instdesc: 'using PXE netboot gtk'
      - lxde:
          my_preseed: 'lxde'
          my_time: '42 10 * * *'
    jobs:
      - '{name}_debian_{my_dist}_{my_desktop}':
          my_title: 'Debian ({my_dist} build CD) {my_desktop} desktop install{my_optdesc}'
          my_description: 'Do a fully automated installation of Debian {my_desktop} desktop{my_optdesc} - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_{my_dist}_{my_preseed}_preseed.cfg">this preseed.cfg</a>){my_instdesc}.'
          my_shell: '/srv/jenkins/bin/g-i-installation.sh 10 {my_inst_url}'

- job-group:
    name: '{name}_debian_jessie_desktops_group'
    my_trigger: ''
    my_optdesc: ''
    my_optdesc2: ''
    my_instdesc: ' using netboot gtk'
    my_dist:
      - jessie:
          my_inst_url: 'http://d-i.debian.org/daily-images/amd64/daily/netboot/gtk/debian-installer/amd64/'
    my_desktop:
      - kde:
          my_preseed: kde
          my_time: '42 15 */2 * *'
      - xfce:
          my_preseed: xfce
          my_time: '42 16 */2 * *'
      - lxde:
          my_preseed: lxde
          my_time: '42 19 */2 * *'
      - gnome:
          my_preseed: gnome
          my_time: '42 19 */2 * *'
          my_trigger: 'g-i-installation_debian_{my_dist}_gnome_brltty, g-i-installation_debian_{my_dist}_gnome_speakup'
      - gnome_brltty:
          my_preseed: gnome_brltty
          my_optdesc: ' with braille display support'
          my_time: ''
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org debian-accessibility@lists.debian.org'
      - gnome_speakup:
          my_preseed: gnome_speakup
          my_optdesc: ' with Speakup support'
          my_time: ''
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org debian-accessibility@lists.debian.org'
      - kfreebsd_xfce:
          my_preseed: kfreebsd # FIXME: if this was 'kfreebsd_xfce' we could do without my_preseed
          my_inst_url: 'http://d-i.debian.org/daily-images/kfreebsd-amd64/daily/netboot-10/gtk/netboot.tar.gz'
          my_time: '42 16 */7 * *'
          my_instdesc: ' using PXE netboot gtk'
      - hurd_lxde:
          my_preseed: hurd_lxde
          my_inst_url: 'http://ftp.debian-ports.org/debian-cd/hurd-i386/debian-hurd-2015/debian-hurd-2015-i386-NETINST-1.iso'
          my_instdesc: ''
          my_time: '42 10 */2 * *'
          my_optdesc2: ' on <a href="https://lists.debian.org/debian-devel-announce/2015/04/msg00012.html">Debian GNU/hurd 2015 Jessie release</a>'
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org debian-hurd@lists.debian.org'
    jobs:
      - '{name}_debian_{my_dist}_{my_desktop}':
          my_title: 'Debian ({my_dist}) {my_desktop} desktop install{my_optdesc}'
          my_description: 'Do a fully automated installation of Debian {my_desktop} desktop{my_optdesc}{my_optdesc2} - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_{my_dist}_{my_preseed}_preseed.cfg">this preseed.cfg</a>){my_instdesc}.'
          my_shell: '/srv/jenkins/bin/g-i-installation.sh 10 {my_inst_url}'
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org'


- job-group:
    name: '{name}_debian_sid_daily_rescue_translations_group'
    my_langname: ''
    my_time: ''
    my_trigger: ''
    my_langname:
      - spanish:
          my_locale: es es_ES
          my_time: '23 7 18 * *'
      - japanese:
          my_locale: ja ja_JA
          my_time: '42 7 18 * *'
      - chinese:
          my_locale: zh zh_CN
          my_time: '23 8 18 * *'
      - korean:
          my_locale: ko ko_KR
          my_time: '42 8 18 * *'
      - russian:
          my_locale: ru ru_RU
          my_time: '42 9 18 * *'
      - greek:
          my_locale: el el_GR
          my_time: '42 9 18 * *'
      - vietnamese:
          my_locale: vi vi_VI
          my_time: '42 9 18 * *'
      - hebrew:
          my_locale: he he_IL
          my_time: '23 10 18 * *'
      - hindi:
          my_locale: hi hi_IN
          my_time: '23 10 18 * *'
      - tamil:
          my_locale: ta ta_IN
          my_time: '42 10 18 * *'
      - tibetan:
         my_locale: bo bo_IN
         my_time: '23 11 18 * *'
      - gujarati:
         my_locale: gu gu_IN
         my_time: '42 11 18 * *'
      - kannada:
         my_locale: kn kn_IN
         my_time: '23 12 18 * *'
      - malayalam:
         my_locale: ml ml_IN
         my_time: '42 12 18 * *'
      - marathi:
         my_locale: mr mr_IN
         my_time: '23 13 18 * *'
      - punjabi:
         my_locale: pa pa_IN
         my_time: '42 13 18 * *'
      - telugu:
         my_locale: te te_IN
         my_time: '23 14 18 * *'
      - arabic:
         my_locale: ar ar_EG
         my_time: '42 14 18 * *'
    jobs:
      - '{name}_debian_sid_daily_rescue_{my_langname}':
          my_title: 'Debian (sid daily build CD) rescue mode in {my_langname}'
          my_shell: '/srv/jenkins/bin/g-i-installation.sh 1 http://cdimage.debian.org/cdimage/daily-builds/sid_d-i/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso {my_locale}'
          my_description: 'Just go into rescue mode via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_sid_daily_rescue_preseed.cfg">this preseed.cfg</a>) using netboot gtk.'
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org'

- job-group:
    name: '{name}_debian-edu_jessie-beta1-netinst_group'
    my_time: ''
    my_trigger: ''
    my_default_desc: ''
    my_recipients: 'jenkins+debian-edu debian-edu-commits@lists.alioth.debian.org'
    my_de_profile:
      - standalone:
          my_disksize: 25
          my_default_desc: ' (Default)'
      - standalone_mate:
          my_disksize: 25
      - main-server:
          my_disksize: 40
      - main+ltsp-server:
          my_disksize: 60
    my_image:
      - beta1-netinst:
          my_image_url: http://ftp.skolelinux.org/skolelinux-cd/debian-edu-8.0+edu0~b1-CD.iso
      - beta1-usb:
          my_image_url: http://ftp.skolelinux.org/skolelinux-cd/debian-edu-8.0+edu0~b1-USB.iso

    jobs:
      - '{name}_debian-edu_jessie-{my_image}_{my_de_profile}':
         my_title: 'Debian Edu (jessie {my_image}) {my_de_profile}{my_default_desc}'
         my_shell: '/srv/jenkins/bin/g-i-installation.sh {my_disksize} {my_image_url}'
         my_description: 'Do a fully automated installation of a Debian Edu Jessie {my_de_profile} profile - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian-edu_jessie-{my_image}_{my_de_profile}_preseed.cfg">this preseed.cfg</a>) using the {my_image} image.<br />This job is only triggered manually.'

- job-group:
    name: '{name}_debian-edu_jessie-daily_group'
    my_time: ''
    my_trigger: ''
    my_default_desc: ''
    my_recipients: 'jenkins+debian-edu debian-edu-commits@lists.alioth.debian.org'
    my_de_profile:
      - standalone:
          my_time: '42 1 */2 * *'
          my_disksize: 25
          my_default_desc: ' (Default)'
      - standalone_mate:
          my_time: '42 1 */2 * *' # FIXME: really meant to be the same as above?
          my_disksize: 25
      - main-server:
          my_time: '42 3 * * *'
          my_disksize: 40
      - main+ltsp-server:
          my_time: '42 0 * * *'
          my_disksize: 60
    my_image:
      - daily-usb:
          my_image_url: http://ftp.skolelinux.org/cd-jessie-usbstick/debian-edu-amd64-i386-BD-1.iso
      - daily-netinst:
          my_image_url: http://ftp.skolelinux.org/cd-jessie-amd64-i386-netinst/debian-edu-amd64-i386-NETINST-1.iso
    jobs:
      - '{name}_debian-edu_jessie-{my_image}_{my_de_profile}':
         my_title: 'Debian Edu (jessie {my_image}) {my_de_profile}{my_default_desc}'
         my_shell: '/srv/jenkins/bin/g-i-installation.sh {my_disksize} {my_image_url}'
         my_description: 'Do a fully automated installation of a Debian Edu Jessie {my_de_profile} profile - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian-edu_jessie-{my_image}_{my_de_profile}_preseed.cfg">this preseed.cfg</a>) using the {my_image} image.'


# =-=-=-=

- project:
    name: g-i-installation
    do_not_edit: '<br><br>Job configuration source is <a href="http://anonscm.debian.org/cgit/qa/jenkins.debian.net.git/tree/job-cfg/g-i-installation.yaml">g-i-installation.yaml</a>.'
    jobs:
      - '{name}_maintenance'
      - '{name}_debian-edu_group'
      - '{name}_debian-edu_desktops_group'
      - '{name}_debian_wheezy_desktops_group'
      - '{name}_debian_jessie_desktops_group'
      - '{name}_debian_sid_daily_rescue_translations_group'
      - '{name}_debian-edu_jessie-beta1-netinst_group'
      - '{name}_debian-edu_jessie-daily_group'
      - '{name}_debian_sid_daily_desktops_group'


      - '{name}_debian_{my_dist}_presentation':
          my_dist:
            - wheezy:
                my_instdesc: 'netboot'
                my_inst_url: 'http://ftp.de.debian.org/debian/dists/wheezy/main/installer-amd64/current/images/netboot/debian-installer/amd64/'
                my_time: '44 15 23 * *'
            - jessie:
                my_instdesc: 'netboot'
                my_inst_url: 'http://d-i.debian.org/daily-images/amd64/daily/netboot/debian-installer/amd64/'
                my_time: '43 15 23 * *'
            - sid_daily:
                my_instdesc: 'build CD'
                my_inst_url: 'http://cdimage.debian.org/cdimage/daily-builds/sid_d-i/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso'
                my_time: '42 15 23 * *'
          my_title: 'Debian-Installer ({my_dist} {my_instdesc}) used for presentations'
          my_shell: '/srv/jenkins/bin/g-i-installation.sh 1 {my_inst_url}'
          my_description: 'Use d-i for presentations via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_{my_dist}_presentation_preseed.cfg">this preseed.cfg</a>).'
          my_trigger: ''
          my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org'


      - '{name}_debian_sid_daily_rescue':
         my_title: 'Debian (sid daily build CD) rescue mode'
         my_shell: '/srv/jenkins/bin/g-i-installation.sh 1 http://cdimage.debian.org/cdimage/daily-builds/sid_d-i/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso'
         my_description: 'Just go into rescue mode via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_sid_daily_rescue_preseed.cfg">this preseed.cfg</a>) using netboot gtk.'
         my_time: '42 6 * * *'
         my_trigger: ''
         my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org'
      - '{name}_debian_sid_daily_rescue_dark_theme':
         my_title: 'Debian (sid daily build CD) rescue mode, using theme=dark'
         my_shell: '/srv/jenkins/bin/g-i-installation.sh 1 http://cdimage.debian.org/cdimage/daily-builds/sid_d-i/arch-latest/amd64/iso-cd/debian-testing-amd64-netinst.iso'
         my_description: 'Just go into rescue mode, using theme=dark, via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_sid_daily_rescue_dark_theme_preseed.cfg">this preseed.cfg</a>) using netboot gtk.'
         my_time: '42 6 * * 7'
         my_trigger: ''
         my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org'
      - '{name}_debian_sid_daily_hurd_lxde':
         my_title: 'Debian (sid daily build CD) LXDE desktop install on Hurd'
         my_shell: '/srv/jenkins/bin/g-i-installation.sh 10 http://people.debian.org/~sthibault/hurd-i386/installer/cdimage/daily/debian-sid-hurd-i386-NETINST-1.iso'
         my_description: 'Do a fully automated installation of Debian LXDE desktop on Hurd - via d-i preseeding (with <a href="https://jenkins.debian.net/d-i-preseed-cfgs/debian_sid_daily_hurd_lxde_preseed.cfg">this preseed.cfg</a>).<br />This job is only triggered manually.'
         my_time: ''
         my_trigger: ''
         my_recipients: 'qa-jenkins-scm@lists.alioth.debian.org debian-hurd@lists.debian.org'


